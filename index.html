<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>T&O Allocation Tool</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; max-width: 700px; }
    input[type="number"] { width: 120px; }
    input[readonly] { background-color: #eee; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: right; }
    th { background: #f4f4f4; }
    .toggle-btn { margin-left: 10px; cursor: pointer; padding: 4px 10px; border: 1px solid #ccc; border-radius: 4px; }
    #scTOContainer { display:inline-block; margin-left:10px; }
</style>
</head>
<body>

<h1>T&O Allocation Tool</h1>

<h2>Step 1: Enter Service Values</h2>
<label>S&C: <input type="number" id="sc" value="400000" onchange="calculate()"> </label>
<span id="scTOContainer">
    T&O Allocation (S&C): <input type="number" id="scTO" value="400000" onchange="calculate()">
</span>
<br>
<label>Technology: <input type="number" id="tech" value="300000" onchange="calculate()"></label><br>
<label>Operations: <input type="number" id="ops" value="300000" onchange="calculate()"></label>

<h2>Step 2: Total Revenue & % of Total</h2>
<label>Total Revenue (auto-calculated): <input type="number" id="totalRevenue" readonly> 100%</label>

<h2>Step 3: Currency / Units</h2>
<label>Home Currency (<input type="text" id="homeCurrency" value="MYR" style="width:50px;">) rate to USD: 
<input type="number" id="currencyRate" value="4.5" onchange="calculate()"></label>
<button class="toggle-btn" onclick="toggleCurrency()">Toggle Currency</button>
<label>Unit: 
<select id="unit" onchange="calculate()">
    <option value="1000">Thousands</option>
    <option value="1000000">Millions</option>
</select>
</label>

<h2>Step 4: Summary Table</h2>
<table id="summaryTable">
    <thead>
        <tr>
            <th>Service</th>
            <th>Value</th>
            <th>% of Total</th>
            <th>T&O Allocation</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<p id="tnoPercentDisplay"><strong>T&O Allocation % = </strong> -- </p>

<script>
let currentCurrency = 'USD';

function calculate() {
    // Get inputs
    const sc = parseFloat(document.getElementById('sc').value) || 0;
    const tech = parseFloat(document.getElementById('tech').value) || 0;
    const ops = parseFloat(document.getElementById('ops').value) || 0;
    const scTOInput = parseFloat(document.getElementById('scTO').value) || 0;
    const unitDiv = parseFloat(document.getElementById('unit').value);
    const currencyRate = parseFloat(document.getElementById('currencyRate').value) || 1;

    // Total revenue
    const totalRevenue = sc + tech + ops;
    document.getElementById('totalRevenue').value = totalRevenue;

    // Show/hide S&C T&O input
    document.getElementById('scTOContainer').style.display = sc > 0 ? 'inline-block' : 'none';

    // Calculate T&O %
    const tnoPercent = sc ? (scTOInput / sc) * 100 : 0;

    // Apply T&O % to other services
    const techTO = tech * tnoPercent / 100;
    const opsTO = ops * tnoPercent / 100;

    // Apply currency
    const currencyMultiplier = currentCurrency === 'USD' ? 1 : currencyRate;

    // Prepare table
    const services = [
        {name:'S&C', value: sc, toValue: scTOInput},
        {name:'Technology', value: tech, toValue: techTO},
        {name:'Operations', value: ops, toValue: opsTO}
    ];

    const tbody = document.getElementById('summaryTable').getElementsByTagName('tbody')[0];
    tbody.innerHTML = '';

    services.forEach(s => {
        const displayValue = (s.value * currencyMultiplier / unitDiv).toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2});
        const displayTO = (s.toValue * currencyMultiplier / unitDiv).toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2});
        const percentOfTotal = totalRevenue ? ((s.value / totalRevenue) * 100).toFixed(2) + '%' : '-';
        const row = `<tr>
                        <td>${s.name}</td>
                        <td>${displayValue}</td>
                        <td>${percentOfTotal}</td>
                        <td>${displayTO}</td>
                    </tr>`;
        tbody.innerHTML += row;
    });

    // Update T&O %
    document.getElementById('tnoPercentDisplay').innerHTML = `<strong>T&O Allocation % = </strong> ${tnoPercent.toFixed(2)}%`;
}

function toggleCurrency() {
    currentCurrency = currentCurrency === 'USD' ? document.getElementById('homeCurrency').value : 'USD';
    calculate();
}

// Initial calculation
calculate();
</script>

</body>
</html>
