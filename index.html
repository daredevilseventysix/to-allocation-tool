<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>T&O Allocation Tool</title>
<style>
body { font-family: Arial, sans-serif; max-width: 900px; margin: 30px auto; }
h2 { margin-top: 30px; }

.row { display: flex; align-items: center; margin-bottom: 10px; }
.row label { width: 200px; }
.row input { width: 180px; padding: 5px; text-align: right; }

.readonly { background-color: #f2f2f2; }

table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
th { background: #f4f4f4; }
th:first-child, td:first-child { text-align: left; }

.capability-table input {
    width: 80px;
    text-align: right;
}
</style>
</head>
<body>

<h1>T&O Allocation Tool</h1>

<h2>1. Enter Service Revenues</h2>

<div class="row">
<label>S&C</label>
<input type="text" id="sc" value="400,000" oninput="calculate()">
</div>

<div class="row">
<label>Technology</label>
<input type="text" id="tech" value="300,000" oninput="calculate()">
</div>

<div class="row">
<label>Operations</label>
<input type="text" id="ops" value="300,000" oninput="calculate()">
</div>

<div class="row">
<label><strong>Total Contract Revenue</strong></label>
<input type="text" id="totalRevenue" class="readonly" readonly>
<span style="margin-left:10px;">100%</span>
</div>

<hr>

<div class="row">
<label><strong>T&O Revenue (S&C)</strong></label>
<input type="text" id="scTO" value="400,000" oninput="calculate()">
</div>

<h2>2. Summary</h2>

<table>
<thead>
<tr>
<th>Service</th>
<th>Total Contract Revenue</th>
<th>% Contract Revenue</th>
<th>T&O Revenue</th>
<th>% T&O Revenue</th>
</tr>
</thead>
<tbody id="summaryTable"></tbody>
</table>

<p id="finalPercent" style="margin-top:20px;font-weight:bold;"></p>

<h2>3. Capabilities</h2>

<div>
<label><input type="checkbox" value="Change & Human Experience" onchange="calculate()"> Change & Human Experience</label><br>
<label><input type="checkbox" value="HRT" onchange="calculate()"> HRT</label><br>
<label><input type="checkbox" value="Learning & Skilling" onchange="calculate()"> Learning & Skilling</label><br>
<label><input type="checkbox" value="OM&OD" onchange="calculate()"> OM&OD</label><br>
<label><input type="checkbox" value="TS&D" onchange="calculate()"> TS&D</label>
</div>

<table class="capability-table">
<thead>
<tr>
<th>Capability</th>
<th>% Allocation</th>
<th>T&O Revenue</th>
</tr>
</thead>
<tbody id="capabilityTable"></tbody>
</table>

<script>
function parseNumber(val){
    return parseFloat(val.replace(/,/g,'')) || 0;
}

function formatNumber(num){
    return num.toLocaleString(undefined,{minimumFractionDigits:0, maximumFractionDigits:0});
}

function calculate(){

    let sc = parseNumber(document.getElementById('sc').value);
    let tech = parseNumber(document.getElementById('tech').value);
    let ops = parseNumber(document.getElementById('ops').value);
    let scTO = parseNumber(document.getElementById('scTO').value);

    let total = sc + tech + ops;

    document.getElementById('totalRevenue').value = formatNumber(total);

    let tnoPercent = sc ? (scTO / sc) * 100 : 0;

    let techTO = tech * tnoPercent / 100;
    let opsTO = ops * tnoPercent / 100;

    let services = [
        {name:"S&C", value:sc, to:scTO},
        {name:"Technology", value:tech, to:techTO},
        {name:"Operations", value:ops, to:opsTO}
    ];

    let table = "";
    services.forEach(s=>{
        let percentTotal = total ? (s.value/total*100).toFixed(2) : "0.00";
        let percentTO = s.value ? (s.to/s.value*100).toFixed(2) : "0.00";
        table += `<tr>
            <td>${s.name}</td>
            <td class="readonly">${formatNumber(s.value)}</td>
            <td class="readonly">${percentTotal}%</td>
            <td>${formatNumber(s.to)}</td>
            <td>${percentTO}%</td>
        </tr>`;
    });

    document.getElementById('summaryTable').innerHTML = table;

    document.getElementById('finalPercent').innerText =
        `T&O Allocation % required to meet S&C Revenues = ${tnoPercent.toFixed(2)}%`;

    // Capabilities
    let checked = document.querySelectorAll('input[type="checkbox"]:checked');
    let capTable = "";
    if(checked.length>0){

        let equalPercent = tnoPercent / checked.length;

        checked.forEach(box=>{
            let revenue = sc * equalPercent / 100;
            capTable += `<tr>
                <td>${box.value}</td>
                <td>${equalPercent.toFixed(2)}%</td>
                <td>${formatNumber(revenue)}</td>
            </tr>`;
        });
    }

    document.getElementById('capabilityTable').innerHTML = capTable;

    // reformat input fields with commas
    document.getElementById('sc').value = formatNumber(sc);
    document.getElementById('tech').value = formatNumber(tech);
    document.getElementById('ops').value = formatNumber(ops);
    document.getElementById('scTO').value = formatNumber(scTO);
}

calculate();
</script>

</body>
</html>
